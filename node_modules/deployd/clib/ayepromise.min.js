/* ayepromise
 * Copyright (c) 2013, Christoph Burgmer
 * BSD Licensed
 */
!function(n,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():n.ayepromise=e()}(this,function(){"use strict";var n={},e=function(){var n=!1;return function(e){return function(){n||(n=!0,e.apply(null,arguments))}}},t=function(n){var e=n&&n.then;return"object"==typeof n&&"function"==typeof e?function(){return e.apply(n,arguments)}:void 0},r=function(e,t){var r=n.defer(),o=function(n,e){setTimeout(function(){var t;try{t=n(e)}catch(o){return void r.reject(o)}t===r.promise?r.reject(new TypeError("Cannot resolve promise with itself")):r.resolve(t)},1)},i=function(n){e&&e.call?o(e,n):r.resolve(n)},c=function(n){t&&t.call?o(t,n):r.reject(n)};return{promise:r.promise,handle:function(n,e){n===u?i(e):c(e)}}},o=0,u=1,i=2;return n.defer=function(){var n,c=o,f=[],a=function(e,t){c=e,n=t,f.forEach(function(e){e.handle(c,n)}),f=null},l=function(n){a(u,n)},s=function(n){a(i,n)},p=function(e,t){var u=r(e,t);return c===o?f.push(u):u.handle(c,n),u.promise},v=function(n){var t=e();try{n(t(d),t(s))}catch(r){t(s)(r)}},d=function(n){var e;try{e=t(n)}catch(r){return void s(r)}e?v(e):l(n)},h=e();return{resolve:h(d),reject:h(s),promise:{then:p,fail:function(n){return p(null,n)}}}},n});
